<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>底部导航</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/style.css" />
    <link rel="stylesheet" type="text/css" href="../../css/aui.css" />
    <style>
    body{
      font-family: "PingFang-SC";
    }
    .linear{
        width:100%;
        background:-webkit-gradient(linear, center top, center bottom,from(#66aaff), to(#6666ff));
    }

    .img_stu{
      width: 46%;
      height: 46%;
      float: right;margin-right: 15%;
      margin-top: 10%;
    }

    .img_teach{
      width: 49%;
      height: 49%;
      margin-top: -9%;
      margin-left: 15%;
    }

    .img_master{
      width: 46%;
      height: 46%;
      float: right;
      margin-top: -20%;
    }

    .img_parent{
      width: 46%;
      height: 46%;
      margin-left: 5%;
      margin-top: -33%;
    }
    .stu_pos{

    }
    .teach_pos{

    }
    .master{

    }
    .parent{

    }
    </style>
</head>

<body class="linear">
    <div class="flex-wrap flex-vertical ">
        <div class="stu_pos">
          <img class="img_stu" src="../../image/student.png" tapmode="hover" onclick="itemClick(1)"></img>
        </div>
        <div class="teach_pos">
          <img class="img_teach" src="../../image/teacher.png" tapmode="hover" onclick="itemClick(2)"></img>
        </div>
        <div class="master">
          <img class="img_master" src="../../image/headmaster.png" tapmode="hover" onclick="itemClick(3)"></img>
        </div>
        <div class="parent">
          <img class="img_parent" src="../../image/parent.png" tapmode="hover" onclick="itemClick(4)"></img>
        </div>

    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript">
    apiready = function() {
        api.parseTapmode();
        // 1 学生 2老师 3校长 4家长
        var zhc_source = $api.getStorage('zhc_source');
        if (zhc_source == 1) {
          var username = $api.getStorage('loginname');
          var password = $api.getStorage('password');
          if (username != null && password != null) {
              var params = {};
              params.username = username;
              params.password = password;
              login(params, 'http://www.yxke12.com/index.php/App/Student/login.html', zhc_source);
          }
        }if (zhc_source == 2) {
          var username = $api.getStorage('username');
          var password = $api.getStorage('password');
          var params = {};
          params.loginuser = username;
          params.password = password;

          if (username != null && password != null) {
              login(params, "http://www.yxke12.com/index.php/Ate/Teacher/login.html", zhc_source);
          }

        }else if (zhc_source == 4) {
          var loginuser = $api.getStorage('loginuser');
          var password = $api.getStorage('password');
          if (loginuser != null && password != null) {
              var params = {};
              params.loginuser = loginuser;
              params.password = password;
              login(params, 'http://www.yxke12.com/index.php/Apa/Parent/login.html', zhc_source);
          }
        }else {

        }


    };

    function itemClick(index) {
        $api.setStorage('zhc_source', index);
        switch (index) {
          case 1:
              api.openWin({
                  name: 'login_win',
                  url: './login_win.html',
                  pageParam: {
                      name: 'test'
                  },
                  slidBackEnabled:false
              });
            break;
          case 2:
            api.openWin({
                name: 'login_win',
                url: '../jiaoshi/register/login_win.html',
                pageParam: {
                    name: 'test'
                },
                slidBackEnabled:false
            });
              break;
          case 4:
            api.openWin({
                name: 'login_win',
                url: '../jiazhang/register/login_win.html',
                pageParam: {
                    name: 'test'
                },
                slidBackEnabled:false
            });
          break;

          default:

        }
    }

    function login(params, url, index) {
      api.showProgress({
          style: 'default',
          animationType: 'fade',
          title: '正在登录...',
          text: '先喝杯茶...',
          modal: true
      });

      api.ajax({
          url: url,
          method: 'post',
          data: {
              values: params
          }
      },function(ret, err){
          api.hideProgress();
          if (ret) {
              if (ret.status == 100) {
                var infos = ret.data;
                if (infos != null) {
                  for (var key in infos) {
                    if (infos.hasOwnProperty(key)) {
                      console.log(key + "-------" + infos[key]);
                        $api.setStorage(key, infos[key]);
                    }
                  }
                  $api.setStorage('password', params.password);
                  comeToSY(index);
                }
              }else {
                $api.clearStorage();
                api.toast({
                    msg: '登录失败',
                    duration: 2000,
                    location: 'bottom'
                });
              }
          } else {
              $api.clearStorage();
              api.toast({
                  msg: 'err.msg',
                  duration: 2000,
                  location: 'bottom'
              });
              // console.log( JSON.stringify( err.msg ) );
          }
      });
    }

    function comeToSY(index){
      $api.setStorage('zhc_source', index);
      if (typeof(index) == 'string') {
          index = parseInt(index);
      }
      switch (index) {
        case 1:
          api.openWin({
              name: 'index',
              url: '../../index.html',
              pageParam: {
                  name: 'test'
              },
              slidBackEnabled:false
          });
          break;
        case 2:
          api.openWin({
              name: 'frame1_win',
              url: '../jiaoshi/shouye/frame1_win.html',
              pageParam: {
                  name: 'test'
              },
              slidBackEnabled:false
          });
          break;
        case 4:
          api.openWin({
              name: 'frame1_win',
              url: '../jiazhang/shouye/frame1_win.html',
              pageParam: {
                  name: 'test'
              },
              slidBackEnabled:false
          });
          break;
        default:
      }
    }
</script>

</html>
